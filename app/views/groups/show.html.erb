<%- model_class = Group -%>
<%= content_for(:breadcrumb) do %>
  <div class="span6">
    <ul class="breadcrumb">
      <li><%= link_to t('home'), root_path %><span class="divider">/</span></li>
      <li><%= link_to resource.organization, [resource.organization] %><span class="divider">/</span></li>
      <li><%= link_to t('divisions'), [current_user, :divisions] %><span class="divider">/</span></li>
      <li><%= link_to resource.division, [current_user, resource.division] %><span class="divider">/</span></li>
      <li class="active"><%= resource %></li>
    </ul>
  </div>  
  
  <div class="span6 btn-group">
    <%= link_to t('metrics'), [:dashboard,@group], class: 'btn btn-primary' %>
    <%= link_to t('download_data'), division_group_path(parent,@group,format:'csv'), class: 'btn btn-primary  modal-trigger', 'data-modal' => 'download-modal' %>
    <%= link_to t('add_member'),new_group_user_path(@group), :class => 'btn btn-primary ' if can? :update, @group  %>
    
    <%= link_to t('.edit', :default => t("helpers.links.edit")),
                [:edit,parent,@group], :class => 'btn ' if can? :update, @group %>
    <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                group_path(@group),
                :method => 'delete',
                :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                :class => 'btn btn-danger ' if can? :destroy, @group %>
  </div>
<% end %>

<% if can?(:mange, @group) %>
  <section>
    <h3><%= t('users') %></h3>
    <table class="table table-striped">
      <tbody>
        <% @group.users.each do |user| %>
          <tr>
            <td><%= link_to(user,user) %></td>
            <td>
              <div class="btn-group">
                <a class="btn btn-inverse btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                  <%= t('actions') %>
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><%= link_to t('remove'),
                                [user,user.assigned_group_for(@group.id)],
                                :method => :delete,
                                :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure? This will this person as a member of the group.')) %></li>
                    <li><%= link_to t('edit'), [:edit,user] %></li>
                </ul>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>
<% end %>

<section class="row-fluid">
  <div class="span12">
    <h2><%=t 'last_5_days' %></h2>
    <div class="group-graph" data-division_id="<%= @group.division.id %>" data-group_id="<%= @group.id %>" data-day_range="5"></div>
  </div>
</section>

<section class="row-fluid">
  <div class="span12">
    <h2><%=t 'last_10_days' %></h2>
    <div class="group-graph" data-division_id="<%= @group.division.id %>" data-group_id="<%= @group.id %>" data-day_range="10"></div>
  </div>
</section>

<section class="row-fluid">
  <div class="span12">
    <h2><%=t 'last_15_days' %></h2>
    <div class="group-graph" data-division_id="<%= @group.division.id %>" data-group_id="<%= @group.id %>" data-day_range="15"></div>
  </div>
</section>  
  
<section class="row-fluid">
  <div class="span12">
    <h2><%=t 'last_30_days' %></h2>
    <div class="group-graph" data-division_id="<%= @group.division.id %>" data-group_id="<%= @group.id %>" data-day_range="30"></div>
  </div>
</section>

<div id="download-modal" class="modal hide fade">
  <form action="<%= division_group_path(parent,@group,format:'csv') %>" method="get" class="horizontal">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Choose Time Frame</h3>
    </div>
    <div class="modal-body">
      <div class="control-group">
        <label class="control-label" for="start_date">Start Date</label>
        <div class="controls">
          <input type="text" class="datepicker" id="start_date" name="start_date" value="<%=l 30.days.ago.to_date, format: :picker %>">
        </div>
      </div>
      <div class="control-group">
        <label class="control-label" for="end_date">End Date</label>
        <div class="controls">
          <input type="text" class="datepicker" id="end_date" name="end_date" value="<%=l Date.today, format: :picker %>">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#" class="btn close-it">Close</a>
      <button type="submit" class="btn btn-primary">Download Data</button>
    </div>
  </form>
</div>
