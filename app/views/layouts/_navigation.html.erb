<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
</a>
<% unless icon_image_tag %>
  <%= link_to "Recovery Tracker", root_path, :class => 'brand' %>
<% else %>
  <%= link_to "#{icon_image_tag} Recovery Tracker".html_safe, root_path, :class => 'brand' %>
<% end %>
<div class="nav-collapse">
  <ul class="nav">
    <% if user_signed_in? %>
      <li class="dropdown">
        <a href="#"class="dropdown-toggle" data-toggle="dropdown"><%=t 'signed_in_as' %>: <%= current_user.name %><b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li>
            <%= link_to t('history'), current_user %>
          </li>
          <li>
            <%= link_to t('edit_account'), edit_user_registration_path %>
          </li>
          <li>
            <%= link_to t('log_out'), destroy_user_session_path, :method=>'delete' %>        
          </li>
          
        </ul>
      <li class="divider-vertical"></li>
    <% else %>
      <li>
        <%= link_to t('log_in'), new_user_session_path %>  
      </li>
    <% end %>
    <li class="dropdown">
      <a href="#"class="dropdown-toggle" data-toggle="dropdown"><%=t 'language' %><b class="caret"></b></a>
      <ul class="dropdown-menu">
        <% Locale.all.each do |locale| %>
          <li>
            <% if I18n.locale.to_s != locale.code %>
              <%= link_to t("#{locale.name.downcase}_alt".to_sym), "?locale=#{locale.code}" %>
            <% else %>
              <%= link_to t("#{locale.name.downcase}".to_sym), "?locale=#{locale.code}" %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </li>
    <% if user_signed_in? %>
      <% if signed_in? && Organization.with_role('admin', current_user).count > 0 %>
        <li class="dropdown">
          <a href="#"class="dropdown-toggle" data-toggle="dropdown"><%=t 'change_divisions' %><b class="caret"></b></a>
          <ul class="dropdown-menu">
            <% current_user.admined_divisions.each do |division| %>
              <li class="<%= @division.try(:id) == division.id ? 'active' : '' %>">
                <%= link_to division, root_url(division_id: division.id) %>
              </li>
            <% end %>
          </ul>
        </li>
        <li class="dropdown pull-right">
          <a href="#"class="dropdown-toggle" data-toggle="dropdown"><%=t 'admin' %><b class="caret"></b></a>
          <ul class="dropdown-menu">
            <% Organization.with_role('admin', current_user).each do |organization| %>
              <li>
                <%= link_to organization, organization %>
              </li>
            <% end %>
            <li class="<%= (controller_name == 'divisions' ? 'active' : '') %>">
              <%= link_to t('divisions'), user_divisions_path(current_user) %>
            </li>
            <li class="<%= (controller_name == 'surveys' ? 'active' : '') %>">
              <%= link_to t('surveys'), surveys_path %>
            </li>
            <li class="<%= (controller_name == 'users' ? 'active' : '') %>">
              <%= link_to t('users'), admin_users_path %>
            </li>
          </ul>
        </li>
      <% end %>
    <% else %>
      <li>
        <%= link_to 'Sign up', new_user_registration_path %>
      </li>
    <% end %>
  </ul>
</div>