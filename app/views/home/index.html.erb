<section id="current-roster">
  <h1>Current Roster</h1>
  <table class="table table-striped">
    <thead>
      <tr>
        <% @groups.each do |group| %>
          <th><%= group.name %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @grouped_users.each_with_index do |grouped_user_row,i| %>
        <tr>
          <% grouped_user_row.each do |grouped_user| %>
            <td>
              <% if grouped_user[i] %>
                <a data-user_id="<%= grouped_user[i].id %>" href="#<%= @survey.assigned_question_sets.first.to_s.parameterize %>" class="user navigate"><%= grouped_user[i] %></a>
              <% else %>
                &nbsp;
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</section>

<% @survey.assigned_question_sets.each_with_index do |assigned_question_set,i| %>
  <section class="clearfix question-set" id="<%= assigned_question_set.name.parameterize %>">
    <h1><%= assigned_question_set %></h1>
    <table class="table">
      <tbody>
        <% assigned_question_set.question_set.assigned_questions.each do |assigned_question| %>
          <tr>
            <td><strong><%= assigned_question %></strong></td>
            <% 0.upto(assigned_question_set.question_set.max_responses).each do |i| %>
              <td>
                <% if assigned_question.question.responses[i] %>
                  <a data-response_id="<%= assigned_question.question.responses[i].id %>" data-question_id="<%= assigned_question.question.id %>" href="#" class="answer btn <%= response_css_point_class(assigned_question.question.responses[i],i+1) %>" data-value="<%= assigned_question.question.responses[i].points %>"><%= assigned_question.question.responses[i].short_text.try(:html_safe) %></a>
                <% else %>
                  &nbsp;
                <% end %>
              </td>
            <% end %>
            <td class="score"><strong></strong></td>
          </tr> 
        <% end %>
      </tbody>
    </table>
    
    <% if assigned_question_set == @survey.assigned_question_sets.first %>
      <a href="#current-roster" class="navigate btn btn-inverse pull-left">Prev</a>
    <% else %>
      <a href="#<%= @survey.assigned_question_sets[i-1].to_s.parameterize %>" class="navigate btn btn-inverse pull-left">Prev</a>
    <% end %>
    
    <% if assigned_question_set == @survey.assigned_question_sets.last %>
      <a href="#summary" data-user_id="<%= current_user.try(:id) %>" data-sumbission-uri="<%= survey_completed_surveys_path(@survey) %>" class="navigate btn btn-primary pull-right next disabled">Submit Answers</a>
    <% else %>
      <a href="#<%= @survey.assigned_question_sets[i+1].to_s.parameterize %>" class="navigate btn btn-inverse pull-right next disabled">Next</a>
    <% end %>
  </section>
<% end %>

<section id="summary">
  <div class="row-fluid">
    <div class="span6" id="final-score">
      <h1>Final Score: <span id="score">0</span></h1>
    </div>
    
    <div class="span6" id="scale">
      <h3>Scale</h3>
      <table class="table table-bordered">
        <% @survey.point_ranges.each_with_index do |point_range,i| %>
          <tr>
            <td><%= point_range_to_html(@survey,point_range,i) %></td>
            <td><%= point_range.name %></td>
          </tr>
        <% end %>
      </table>
    </div>
  </div>
  
  <div class="row-fluid">
    <div class="span6" id="needs-for-improvement">
      <h3>Individual Needs for improvement</h3>
      <dl>
        <dt>Recovery Habits</dt>
        <dd>A description list is perfect for defining terms.</dd>
        <dt>Nutrition</dt>
        <dd>Vestibulum id ligula porta felis euismod semper eget lacinia odio sem nec elit.</dd>
        <dd>Donec id elit non mi porta gravida at eget metus.</dd>
        <dt>Uncontrolables</dt>
        <dd>Etiam porta sem malesuada magna mollis euismod.</dd>
      </dl>
    </div>
  
    <div class="span6" id="graph">
      <h2><%=t 'last_5_days' %></h2>
      <div class="graph" data-user_id="<%= current_user.try(:id) %>" data-day_range="5"></div>
    </div>
  </div>
</section>
